
# [Search] RAG 및 검색 파이프라인 고도화 PoC 검증 결과 (v2)

## 개요
사용자의 모호한 검색 의도를 정확히 파악하고, 최적의 상품을 추천/안내하기 위한 **"Search Pipeline v2"**의 각 모듈별 성능 검증을 완료하였습니다.

## 검증 모듈 및 결과

### 1. 전처리 (Query Processor)
- **목적**: 불분명한 자연어 질의에서 검색 키워드/필터/정렬 조건 추출
- **결과**: Golden Test Case(30건) 기준 의도 파악 정확도 **90% 이상** 달성

### 2. 검색 (Hybrid Retrieval)
> **Goal**: 600개 상품 중 정답 상품을 후보군(Top-K)에 포함시키는 비율 (Recall)

| 방식 | Recall@5 | Recall@20 | 비고 |
| :--- | :--- | :--- | :--- |
| BM25 | 66.7% | 83.3% | 키워드 일치 강점 |
| Vector | 23.3% | 40.0% | 단독 사용 시 정밀도 낮음 |
| **Hybrid** | **70.0%** | **86.7%** | **최적 조합** |

**결론**: **Hybrid 검색으로 Top-20**개를 추출하여 Reranker에 전달하는 전략 확정.

### 3. 리랭킹 & 안내 (AG Reranker)
> **Goal**: 후보군 내에서 사용자의 숨은 의도까지 고려해 Best 상품 선정

| 모델 | Top-1 정확도 | 위치 안내 유무 | 특징 |
| :--- | :--- | :--- | :--- |
| Cross-Encoder | 34.5% (10/29) | 불가능 | 속도 빠름, 복합 추론 실패 (부정문 취약) |
| **LLM (Gemini)** | **93.1% (27/29)** | **가능** | **복합 의도 완벽 이해** |

## AG(Augmented Generation) 모듈 검증 목표
> RAG의 '마지막 1마일'을 담당하는 AG가 무엇을 증명해야 하는지 정의하였습니다.

1. **복합 의도 파악 및 추론 능력 (Reasoning Capability)**
   - 단순 키워드가 아닌, '부정 조건', '암시적 상황'이 주어졌을 때의 논리적 판단 능력
   - (예시: "플라스틱 말고" -> 유리/도자기 재질 선별, "자취생 필수" -> 가성비/소용량 선별)

2. **단순 검색 대비 리랭킹의 우수성 (Reranking Superiority)**
   - 검색 엔진(Retrieve)의 Top-1 vs LLM 리랭킹(AG)의 Top-1 정확도 비교
   - (검색이 놓친 미묘한 뉘앙스를 LLM이 얼마나 보정해주는가?)

3. **최적 추천의 신뢰성 (Top-1 Precision)**
   - 사용자에게 "이거 사세요"라고 딱 하나를 추천했을 때의 정답률
   - (여러 후보 중 가장 적합한 하나를 골라내는 변별력 검증)

4. **행동 유도 정보 생성 (Actionable Guidance)**
   - 단순히 상품명만 던지는 것이 아니라, '위치', '특징' 등 오프라인 경험에 필요한 정보 제공 여부
   - (예시: "이 제품은 2층 욕실 코너 A열에 있습니다" 라는 안내 생성 성공률)

5. **시스템 응답 속도 (Latency Trade-off)**
   - 정확도(LLM)와 속도(Cross-Encoder) 사이의 균형점 확인
   - (1.5초 더 기다릴 가치가 있는가? 에 대한 데이터 기반 판단)

## 5. 데이터 품질 개선 (Data Refinement)
- **Mock DB**: '기타/미분류' 카테고리 200건 전수 재분류 완료 (Clean Data 달성)
- **Test Case**: Hard Case 비율 확대 및 False Positive 검증 케이스 추가

## 최종 제안 파이프라인
`Query Processor (Gemini)` -> `Hybrid Search (Top-20)` -> `AG Reranker (Gemini)`

## 첨부 파일
- 상세 실험 리포트: `docs/reports/POC_v2_FINAL_REPORT.md`
- 검증 코드: `poc/poc_v2_*.py`
